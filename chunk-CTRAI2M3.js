import{a as I,c as w,d as T}from"./chunk-VCBD6SY4.js";import{$ as O,X as k,aa as M,ba as L,ca as A,da as N,ea as q,fa as z}from"./chunk-SFZZCDKE.js";import{d as x,k as F,sa as u,ta as B}from"./chunk-EVD2BUVM.js";import"./chunk-EJJBCPAK.js";import{Ab as D,Bb as E,C as g,Hc as G,Ib as b,K as h,Wa as y,_b as v,a as s,b as a,da as n,gb as m,ja as S,lc as P,o as d,ob as C,s as c,x as f,zb as _}from"./chunk-WP6F2UKX.js";var de=(()=>{class p{constructor(){this.gridConfigSig=m({}),this.gridDataSig=m([]),this.isLoadingGridDataSig=m(!0),this._positions=[],this._countries=[],this._genders=[{id:"all",description:"Todos"},{id:0,description:"No binario"},{id:1,description:"Masculino"},{id:2,description:"Femenino"}],this._queryParams={componentPath:"employee-grid-infinite",componentName:"Grilla scroll infinito"},this._employeeFilterParams={},this._employeeServices=n(k),this._exportService=n(T),this._cdr=n(P),this._spinnerService=n(B),this._breadcrumbService=n(A),this._alertService=n(q),this._positionServices=n(M),this._countryServices=n(L),this._router=n(F),this._alertService.clearAlerts(),this._setBreadcrumb(),this.gridConfigSig.set(this._setGridConfiguration())}ngOnInit(){this._loadData()}ngOnDestroy(){this._breadcrumbService.clearBreadcrumbs()}onRowDblClick(i){let e=i;this._editEmployee(e.id)}onCreateEmployee(){this._router.navigate(["/employee/create"],{queryParams:this._queryParams})}onInfiniteGridScroll(){let i=this.gridConfigSig().paginator?.totalCount||0,e=this.gridDataSig.length;this.isLoadingGridDataSig()||e>=i||(this.isLoadingGridDataSig.set(!0),this._employeeFilterParams=a(s({},this._employeeFilterParams),{page:(this._employeeFilterParams.page||1)+1}),this._getEmployees(!0))}onGridSortChange(i){let e=i.active,t=i.direction;this._employeeFilterParams=a(s({},this._employeeFilterParams),{sortColumn:e,sortOrder:t,page:1}),this._getEmployees()}onGridPageChange(i){this.gridConfigSig().hasInfiniteScroll||(this._employeeFilterParams=a(s({},this._employeeFilterParams),{page:i.pageIndex+1,limit:i.pageSize}),this._getEmployees())}onExportToExcel(){this._spinnerService.show(),this._employeeServices.getEmployeesForExportJsonServer(this._employeeFilterParams).pipe(c(i=>this._mapEmployeesForExport(i))).subscribe({next:i=>{let e="Empleados.xlsx";setTimeout(()=>{this._exportService.exportToExcel(i,e),this._spinnerService.hide(),this._cdr.markForCheck()},1500)},error:()=>{this._spinnerService.hide(),this._cdr.markForCheck(),this._alertService.showDanger("Error al descargar Excel")}})}_mapEmployeesForExport(i){return i.map(e=>{let t=e.birthDate,r=t?u.fromISO(t).toFormat("dd/MM/yyyy"):null;return{id:e.id,nombre:e.name||null,apellido:e.surname||null,puesto:this._getPositionDescription(e.positionId),pais:this._getCountryDescription(e.countryId),genero:this._getGenderDescription(e.genderId),estado:typeof e.active=="boolean"?e.active?"Activo":"Inactivo":null,nacimiento:r}})}_setEmployeeFilterParameters(){this._employeeFilterParams.page=1,this._employeeFilterParams.limit=25,this._employeeFilterParams.sortColumn="id",this._employeeFilterParams.sortOrder="asc"}_getEmployees(i=!1){this.isLoadingGridDataSig.set(!0),i||this.gridDataSig.set([]),this._employeeServices.getEmployees(this._employeeFilterParams).pipe(c(e=>this._mapPaginatedListToGridData(e)),h(()=>{this.isLoadingGridDataSig.set(!1),this._cdr.markForCheck()})).subscribe({next:e=>{let t=i?[...this.gridDataSig(),...e.items]:e.items;this.gridDataSig.set(t),this._updateGridConfig(e)},error:e=>{this.isLoadingGridDataSig.set(!1),this._alertService.showDanger(`Error al obtener empleados. ${e.statusText}`)}})}_loadData(){this._setEmployeeFilterParameters(),f({positions:this._getPositions(),countries:this._getCountries()}).pipe(h(()=>{this._cdr.markForCheck()})).subscribe({next:i=>{this._positions=i.positions,this._countries=i.countries,this._getEmployees()},error:()=>{this.isLoadingGridDataSig.set(!1),this._alertService.showDanger("Error al cargar datos.")}})}_getPositions(){return this._positionServices.getPositions().pipe(g(()=>(this._alertService.showDanger("Error al cargar la lista de puestos."),d([]))))}_getCountries(){return this._countryServices.getCountries().pipe(g(()=>(this._alertService.showDanger("Error al cargar la lista de paises."),d([]))))}_mapPaginatedListToGridData(i){let e=i.items.map(t=>{let r={imgUrl:t.imgUrl,id:t.id,elipsisActions:this._setElipsisActions(t),name:t.name,surname:t.surname,birthDate:t.birthDate,active:t.active,position:this._getPositionDescription(t.positionId),gender:this._getGenderDescription(t.genderId),country:this._getCountryDescription(t.countryId)};if(typeof t.birthDate=="string"){let o=u.fromISO(t.birthDate);r.birthDate=o.isValid?o.toFormat("dd/MM/yyyy"):t.birthDate}else r.birthDate=t.birthDate;return r});return a(s({},i),{items:e,pageIndex:i.page-1})}_getCountryDescription(i){return this._countries.find(e=>e.id===i)?.description||""}_getPositionDescription(i){return this._positions.find(e=>e.id===i)?.description||""}_getGenderDescription(i){return this._genders.find(e=>e.id===i)?.description||""}_setElipsisActions(i){return[{id:"edit",label:"Editar",icon:"edit",action:e=>this._editEmployee(e)},{id:"delete",label:"Eliminar",icon:"delete_forever",action:e=>this._deleteEmployee(e),condition:()=>i.active===!1}]}_editEmployee(i){this._router.navigate([`/employee/edit/${i}`],{queryParams:this._queryParams})}_deleteEmployee(i){console.log(`Parent Log: Intentando eliminar empleado con ID: ${i}`)}_updateGridConfig(i){let{totalCount:e,pageIndex:t,pageSize:r}=i,{sortColumn:o="",sortOrder:R=""}=this._employeeFilterParams,l=this.gridConfigSig().paginator;l&&(l.totalCount=e,l.pageSize=r,l.pageIndex=t);let $={columnName:o,direction:R};this.gridConfigSig.update(H=>a(s({},H),{paginator:l,OrderBy:$}))}_setGridConfiguration(){return I({columns:[{name:"imgUrl",type:"img",width:"20px",isSortable:!1,hasHeader:!1},{name:"id",width:"20px"},{name:"name"},{name:"surname"},{name:"birthDate"},{name:"gender",isSortable:!1},{name:"position",isSortable:!1},{name:"country",isSortable:!1},{name:"active",class:"status-circle",align:"center",width:"20px"},{name:"elipsisActions",align:"center",isSortable:!1,type:"elipsis",hasHeader:!1}],hasInfiniteScroll:!0,OrderBy:{columnName:this._employeeFilterParams.sortColumn||"id",direction:this._employeeFilterParams.sortOrder||"asc"},filterByColumn:"",hasChips:!1,actionButtons:[{class:"primary-button",icon:"assets/person.svg",text:"Agregar",action:()=>this.onCreateEmployee()},{class:"download-button",type:"download",icon:"assets/download.svg",tooltip:"Descargar excel"}]})}_setBreadcrumb(){this._breadcrumbService.setBreadcrumbs([{label:"Inicio",path:"/"},{label:`${this._queryParams.componentName}`,path:"/employees"}])}static{this.\u0275fac=function(e){return new(e||p)}}static{this.\u0275cmp=S({type:p,selectors:[["app-employee-grid-infinite"]],standalone:!0,features:[v],decls:4,vars:3,consts:[[1,"employee-grid-infinite-container"],[3,"sortChange","exportExcel","createButtonClicked","rowDblClick","infiniteScroll","pageChange","gridConfigSig","gridDataSig","isLoadingSig"]],template:function(e,t){e&1&&(_(0,"div",0),E(1,"app-breadcrumb")(2,"app-alert"),_(3,"app-grid",1),b("sortChange",function(o){return t.onGridSortChange(o)})("exportExcel",function(){return t.onExportToExcel()})("createButtonClicked",function(){return t.onCreateEmployee()})("rowDblClick",function(o){return t.onRowDblClick(o)})("infiniteScroll",function(){return t.onInfiniteGridScroll()})("pageChange",function(o){return t.onGridPageChange(o)}),D()()),e&2&&(y(3),C("gridConfigSig",t.gridConfigSig())("gridDataSig",t.gridDataSig())("isLoadingSig",t.isLoadingGridDataSig()))},dependencies:[G,x,w,O,N,z],styles:[".employee-grid-infinite-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:700px;padding:20px 0}.employee-grid-infinite-container[_ngcontent-%COMP%]   app-alert[_ngcontent-%COMP%]{grid-column:1/-1}"],changeDetection:0})}}return p})();export{de as EmployeeGridInfiniteComponent};
