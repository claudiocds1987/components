import{a as b,c as x,d as A}from"./chunk-IDIHOSB6.js";import{$ as I,X as P,aa as M,ba as T,ca as k,da as B,ea as L,fa as F}from"./chunk-GNK5IJR7.js";import{d as C,k as E,sa as G,ta as w}from"./chunk-ECH5AE5E.js";import"./chunk-EJJBCPAK.js";import{Ab as _,Bb as f,C as l,Hc as v,Ib as y,K as m,Wa as h,_b as D,da as r,gb as p,ja as g,lc as S,o as a,ob as u,x as d,zb as c}from"./chunk-NRWBAAQU.js";var re=(()=>{class s{constructor(){this.gridConfig=p({}),this.gridData=p([]),this.isLoadingGridData=p(!0),this._employees=[],this._positions=[],this._countries=[],this._genders=[{id:"all",description:"Todos"},{id:0,description:"No binario"},{id:1,description:"Masculino"},{id:2,description:"Femenino"}],this._queryParams={componentPath:"employee-grid-all",componentName:"Grilla no paginada"},this._employeeService=r(P),this._exportService=r(A),this._spinnerService=r(w),this._changeDetectorRef=r(S),this._alertService=r(L),this._breadcrumbService=r(k),this._positionServices=r(M),this._countryServices=r(T),this._router=r(E),this._alertService.clearAlerts(),this._setBreadcrumb(),this.gridConfig.set(this._setGridConfiguration())}ngOnInit(){this._loadData()}ngOnDestroy(){this._breadcrumbService.clearBreadcrumbs()}onRowDblClick(i){let e=i;this._editEmployee(e.id)}onCreateEmployee(){this._router.navigate(["/employee/create"],{queryParams:this._queryParams})}onExportToExcel(i){this._spinnerService.show();let e=this._mapEmployeesForExport(i),t="Empleados.xlsx";setTimeout(()=>{this._exportService.exportToExcel(e,t),this._spinnerService.hide(),this._changeDetectorRef.markForCheck()},1500)}_mapEmployeesForExport(i){return i.map(e=>({Id:e.id,Nombre:e.name||null,Apellido:e.surname||null,Puesto:e.position,Pais:e.country,Genero:e.gender,Estado:typeof e.active=="boolean"?e.active?"Activo":"Inactivo":null,Nacimiento:e.birthDate}))}_loadData(){d({positions:this._getPositions(),countries:this._getCountries(),employees:this._getEmployeeAll()}).pipe(m(()=>{this.isLoadingGridData.set(!1)})).subscribe({next:i=>{this._positions=i.positions,this._countries=i.countries,this._employees=i.employees,this.gridData.set(this._mapEmployeeListToGridData(this._employees))},error:()=>{this.isLoadingGridData.set(!1),this._alertService.showDanger("Error al cargar datos.")}})}_getEmployeeAll(){return this._employeeService.getEmployeesAll().pipe(l(()=>(this._alertService.showDanger("Error al cargar la lista de empleados."),a([]))))}_getPositions(){return this._positionServices.getPositions().pipe(l(()=>(this._alertService.showDanger("Error al cargar la lista de puestos."),a([]))))}_getCountries(){return this._countryServices.getCountries().pipe(l(()=>(this._alertService.showDanger("Error al cargar la lista de paises."),a([]))))}_mapEmployeeListToGridData(i){return i.map(t=>{let o={imgUrl:t.imgUrl,id:t.id,elipsisActions:this._setElipsisActions(t),name:t.name,surname:t.surname,birthDate:t.birthDate,active:t.active,position:this._getPositionDescription(t.positionId),gender:this._getGenderDescription(t.genderId),country:this._getCountryDescription(t.countryId)};if(typeof t.birthDate=="string"){let n=G.fromISO(t.birthDate);o.birthDate=n.isValid?n.toFormat("dd/MM/yyyy"):t.birthDate}else o.birthDate=t.birthDate;return o})}_setGridConfiguration(){return b({columns:[{name:"imgUrl",type:"img",width:"20px",isSortable:!1,hasHeader:!1},{name:"id",width:"20px"},{name:"name"},{name:"surname"},{name:"birthDate",type:"date"},{name:"gender",isSortable:!1},{name:"position"},{name:"country"},{name:"active",class:"status-circle",align:"center",width:"20px"},{name:"elipsisActions",align:"center",isSortable:!1,type:"elipsis",hasHeader:!1}],filterByColumn:"id",hasInputSearch:!0,hasChips:!1,actionButtons:[{class:"primary-button",icon:"assets/person.svg",text:"Agregar",action:()=>this.onCreateEmployee()},{class:"download-button",type:"download",icon:"assets/download.svg",tooltip:"Descargar excel"}],paginator:{pageSizeOptions:[25,50],pageSize:25,pageIndex:0,totalCount:0,isServerSide:!1},hasSorting:{isServerSide:!1}})}_getCountryDescription(i){return this._countries.find(e=>e.id===i)?.description||""}_getPositionDescription(i){return this._positions.find(e=>e.id===i)?.description||""}_getGenderDescription(i){return this._genders.find(e=>e.id===i)?.description||""}_setElipsisActions(i){return[{id:"edit",label:"Editar",icon:"edit",action:e=>this._editEmployee(e)},{id:"delete",label:"Eliminar",icon:"delete_forever",action:e=>this._deleteEmployee(e),condition:()=>i.active===!1}]}_editEmployee(i){this._router.navigate([`/employee/edit/${i}`],{queryParams:this._queryParams})}_deleteEmployee(i){console.log(`Parent Log: Intentando eliminar empleado con ID: ${i}`)}_setBreadcrumb(){this._breadcrumbService.setBreadcrumbs([{label:"Inicio",path:"/"},{label:`${this._queryParams.componentName}`,path:"/employees"}])}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275cmp=g({type:s,selectors:[["app-employee-grid-all"]],standalone:!0,features:[D],decls:4,vars:3,consts:[[1,"employee-grid-all-container"],[3,"exportExcelClientSide","createButtonClicked","rowDblClick","gridConfigSig","gridDataSig","isLoadingSig"]],template:function(e,t){e&1&&(c(0,"div",0),f(1,"app-breadcrumb")(2,"app-alert"),c(3,"app-grid",1),y("exportExcelClientSide",function(n){return t.onExportToExcel(n)})("createButtonClicked",function(){return t.onCreateEmployee()})("rowDblClick",function(n){return t.onRowDblClick(n)}),_()()),e&2&&(h(3),u("gridConfigSig",t.gridConfig())("gridDataSig",t.gridData())("isLoadingSig",t.isLoadingGridData()))},dependencies:[v,C,x,I,B,F],styles:[".employee-grid-all-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:700px;padding:20px 0}.employee-grid-all-container[_ngcontent-%COMP%]   app-alert[_ngcontent-%COMP%]{grid-column:1/-1}"]})}}return s})();export{re as EmployeeGridAllComponent};
