import{b as m}from"./chunk-UK7LF3J5.js";import{C as n,T as p,W as c,Z as f,da as h,f as u,j as i,o as l}from"./chunk-AH7QKKW6.js";var U=(()=>{class o{constructor(){this._apiUrl="https://json-server-data-fpl9.onrender.com/profile",this._usersUrl="https://json-server-data-fpl9.onrender.com/users",this.userProfileDataSubject=new i(null),this._http=h(m),this.userProfileDataSubject=new i(null),this.userProfileData$=this.userProfileDataSubject.asObservable(),this.loadUserProfile().subscribe()}login(e){return this._http.get(`${this._usersUrl}?username=${e.username}`).pipe(p(t=>{let r=t[0];if(r&&r.password===e.password){let s={id:r.id,username:r.username,roles:r.roles};return this.userProfileDataSubject.next(s),l(s)}return new u(s=>{s.complete()})}),n(t=>{throw t}))}logout(){this.userProfileDataSubject.next(null),console.log("Sesi\xF3n cerrada (Logout exitoso). Perfil limpiado.")}loadUserProfile(){return this._http.get(this._apiUrl).pipe(c(e=>{this.userProfileDataSubject.next(e)}),n(e=>(this.userProfileDataSubject.next(null),l({id:0,username:"Error",roles:[]}))))}hasAccess(e){if(!e||Array.isArray(e)&&e.length===0)return!0;let t=this.userProfileDataSubject.getValue()?.roles;if(!t)return!1;let r=Array.isArray(e)?e.map(a=>a.toUpperCase()):[e.toUpperCase()],s=t.map(a=>a.toUpperCase());return r.some(a=>s.includes(a))}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=f({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{U as a};
