import{a as B,c as T,d as M}from"./chunk-SPPO7YFN.js";import"./chunk-JIAQZAXE.js";import{a as z,b as H}from"./chunk-22RIDEX4.js";import{a as O,e as A}from"./chunk-UNNSDSQF.js";import{a as I}from"./chunk-EJTDO335.js";import{a as k}from"./chunk-Q6UAVVOY.js";import"./chunk-SFWTOUAD.js";import{c as L,d as q,e as N,f as R}from"./chunk-VXZZXDIS.js";import{z as u}from"./chunk-5YESZIAT.js";import{D as w}from"./chunk-BMLLSFUZ.js";import{d as F,j as G}from"./chunk-FRIGIZR4.js";import{Bb as _,Cb as D,D as g,Db as b,Jc as x,Kb as E,L as h,Xa as y,a,ac as v,b as s,ea as o,hb as m,ka as S,nc as P,p as d,pb as C,t as c,y as f}from"./chunk-Y3ZRIA3V.js";var _e=(()=>{class p{constructor(){this.gridConfigSig=m({}),this.gridDataSig=m([]),this.isLoadingGridDataSig=m(!0),this._positions=[],this._countries=[],this._genders=[{id:"all",description:"Todos"},{id:0,description:"No binario"},{id:1,description:"Masculino"},{id:2,description:"Femenino"}],this._queryParams={componentPath:"employee-grid-infinite",componentName:"Grilla scroll infinito"},this._employeeFilterParams={},this._employeeServices=o(O),this._exportService=o(M),this._cdr=o(P),this._spinnerService=o(k),this._breadcrumbService=o(N),this._alertService=o(w),this._positionServices=o(L),this._countryServices=o(q),this._router=o(G),this._feedbackDialogService=o(z),this._snackbarService=o(H),this._alertService.clearAlerts(),this._setBreadcrumb(),this.gridConfigSig.set(this._setGridConfiguration())}ngOnInit(){this._loadData()}ngOnDestroy(){this._breadcrumbService.clearBreadcrumbs()}onRowDblClick(i){let e=i;this._editEmployee(e.id)}onCreateEmployee(){this._router.navigate(["/employee/create"],{queryParams:this._queryParams})}onInfiniteGridScroll(){let i=this.gridConfigSig().paginator?.totalCount||0,e=this.gridDataSig.length;this.isLoadingGridDataSig()||e>=i||(this.isLoadingGridDataSig.set(!0),this._employeeFilterParams=s(a({},this._employeeFilterParams),{page:(this._employeeFilterParams.page||1)+1}),this._getEmployees(!0))}onGridSortChange(i){let e=i.active,t=i.direction;this._employeeFilterParams=s(a({},this._employeeFilterParams),{sortColumn:e,sortOrder:t,page:1}),this._getEmployees()}onGridPageChange(i){this.gridConfigSig().hasInfiniteScroll||(this._employeeFilterParams=s(a({},this._employeeFilterParams),{page:i.pageIndex+1,limit:i.pageSize}),this._getEmployees())}onExportToExcel(){this._spinnerService.show(),this._employeeServices.getEmployeesForExportJsonServer(this._employeeFilterParams).pipe(c(i=>this._mapEmployeesForExport(i))).subscribe({next:i=>{let e="Empleados.xlsx";setTimeout(()=>{this._exportService.exportToExcel(i,e),this._spinnerService.hide(),this._cdr.markForCheck()},1500)},error:()=>{this._spinnerService.hide(),this._cdr.markForCheck(),this._alertService.showDanger("Error al descargar Excel")}})}_mapEmployeesForExport(i){return i.map(e=>{let t=e.birthDate,r=t?u.fromISO(t).toFormat("dd/MM/yyyy"):null;return{id:e.id,nombre:e.name||null,apellido:e.surname||null,puesto:this._getPositionDescription(e.positionId),pais:this._getCountryDescription(e.countryId),genero:this._getGenderDescription(e.genderId),estado:typeof e.active=="boolean"?e.active?"Activo":"Inactivo":null,nacimiento:r}})}_setEmployeeFilterParameters(){this._employeeFilterParams={},this._employeeFilterParams.page=1,this._employeeFilterParams.limit=25,this._employeeFilterParams.sortColumn="id",this._employeeFilterParams.sortOrder="asc"}_getEmployees(i=!1){this.isLoadingGridDataSig.set(!0),i||this.gridDataSig.set([]),this._employeeServices.getEmployees(this._employeeFilterParams).pipe(c(e=>this._mapPaginatedListToGridData(e)),h(()=>{this.isLoadingGridDataSig.set(!1),this._cdr.markForCheck()})).subscribe({next:e=>{let t=i?[...this.gridDataSig(),...e.items]:e.items;this.gridDataSig.set(t),this._updateGridConfig(e)},error:e=>{this.isLoadingGridDataSig.set(!1),this._alertService.showDanger(`Error al obtener empleados. ${e.statusText}`)}})}_loadData(){this._setEmployeeFilterParameters(),f({positions:this._getPositions(),countries:this._getCountries()}).pipe(h(()=>{this._cdr.markForCheck()})).subscribe({next:i=>{this._positions=i.positions,this._countries=i.countries,this._getEmployees()},error:()=>{this.isLoadingGridDataSig.set(!1),this._alertService.showDanger("Error al cargar datos.")}})}_getPositions(){return this._positionServices.getPositions().pipe(g(()=>(this._alertService.showDanger("Error al cargar la lista de puestos."),d([]))))}_getCountries(){return this._countryServices.getCountries().pipe(g(()=>(this._alertService.showDanger("Error al cargar la lista de paises."),d([]))))}_mapPaginatedListToGridData(i){let e=i.items.map(t=>{let r={imgUrl:t.imgUrl,id:t.id,elipsisActions:this._setElipsisActions(t),name:t.name,surname:t.surname,birthDate:t.birthDate,active:t.active,position:this._getPositionDescription(t.positionId),gender:this._getGenderDescription(t.genderId),country:this._getCountryDescription(t.countryId)};if(typeof t.birthDate=="string"){let n=u.fromISO(t.birthDate);r.birthDate=n.isValid?n.toFormat("dd/MM/yyyy"):t.birthDate}else r.birthDate=t.birthDate;return r});return s(a({},i),{items:e,pageIndex:i.page-1})}_getCountryDescription(i){return this._countries.find(e=>e.id===i)?.description||""}_getPositionDescription(i){return this._positions.find(e=>e.id===i)?.description||""}_getGenderDescription(i){return this._genders.find(e=>e.id===i)?.description||""}_setElipsisActions(i){return[{id:"edit",label:"Editar",icon:"edit",action:e=>this._editEmployee(e)},{id:"delete",label:"Eliminar",icon:"delete_forever",action:e=>this._deleteEmployee(e),condition:()=>i.active===!1}]}_editEmployee(i){this._router.navigate([`/employee/edit/${i}`],{queryParams:this._queryParams})}_deleteEmployee(i){this._openConfirmationDialog().subscribe(e=>{e&&this._employeeServices.deleteEmployee(i).subscribe({next:()=>{this._showSnackbar(),this._setEmployeeFilterParameters(),this._getEmployees()},error:()=>{this._alertService.showDanger("Error al eliminar el empleado.")}})})}_updateGridConfig(i){let{totalCount:e,pageIndex:t,pageSize:r}=i,{sortColumn:n="",sortOrder:U=""}=this._employeeFilterParams,l=this.gridConfigSig().paginator;l&&(l.totalCount=e,l.pageSize=r,l.pageIndex=t);let $={columnName:n,direction:U};this.gridConfigSig.update(J=>s(a({},J),{paginator:l,OrderBy:$}))}_setGridConfiguration(){return B({columns:[{name:"imgUrl",type:"img",width:"100px",isSortable:!1,hasHeader:!1},{name:"id",width:"100px"},{name:"name",width:"200px"},{name:"surname",width:"200px"},{name:"birthDate"},{name:"gender",isSortable:!1},{name:"position",isSortable:!1},{name:"country",isSortable:!1},{name:"active",class:"status-circle",align:"center",width:"75px"},{name:"elipsisActions",width:"100px",align:"center",isSortable:!1,type:"elipsis",hasHeader:!1}],hasInfiniteScroll:!0,OrderBy:{columnName:this._employeeFilterParams.sortColumn||"id",direction:this._employeeFilterParams.sortOrder||"asc"},filterByColumn:"",hasChips:!1,actionButtons:[{class:"primary-button",icon:"assets/person.svg",text:"Agregar",action:()=>this.onCreateEmployee()},{class:"download-button",type:"download",icon:"assets/download.svg",tooltip:"Descargar excel"}]})}_openConfirmationDialog(){return this._feedbackDialogService.openFeedbackDialog({type:"warning",title:"El registro se eliminar\xE1.",message:" \xBFEst\xE1 seguro/a que desea Eliminar?",showButtons:!0,cancelButtonText:"Cancelar",acceptButtonText:"Aceptar"}).afterClosed().pipe(c(e=>!!e))}_showSnackbar(){this._snackbarService.show({message:"\xA1Eliminado con \xE9xito!"})}_setBreadcrumb(){this._breadcrumbService.setBreadcrumbs([{label:"Inicio",path:"/home"},{label:`${this._queryParams.componentName}`,path:"/employees"}])}static{this.\u0275fac=function(e){return new(e||p)}}static{this.\u0275cmp=S({type:p,selectors:[["app-employee-grid-infinite"]],standalone:!0,features:[v],decls:4,vars:3,consts:[[1,"employee-grid-infinite-container"],[3,"sortChange","exportExcel","createButtonClicked","rowDblClick","infiniteScroll","pageChange","gridConfigSig","gridDataSig","isLoadingSig"]],template:function(e,t){e&1&&(_(0,"div",0),b(1,"app-breadcrumb")(2,"app-alert"),_(3,"app-grid",1),E("sortChange",function(n){return t.onGridSortChange(n)})("exportExcel",function(){return t.onExportToExcel()})("createButtonClicked",function(){return t.onCreateEmployee()})("rowDblClick",function(n){return t.onRowDblClick(n)})("infiniteScroll",function(){return t.onInfiniteGridScroll()})("pageChange",function(n){return t.onGridPageChange(n)}),D()()),e&2&&(y(3),C("gridConfigSig",t.gridConfigSig())("gridDataSig",t.gridDataSig())("isLoadingSig",t.isLoadingGridDataSig()))},dependencies:[x,F,T,A,R,I],styles:[".employee-grid-infinite-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:700px;padding:20px}.employee-grid-infinite-container[_ngcontent-%COMP%]   app-alert[_ngcontent-%COMP%]{grid-column:1/-1}"],changeDetection:0})}}return p})();export{_e as EmployeeGridInfiniteComponent};
