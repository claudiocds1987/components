import{c as Te}from"./chunk-LBG7LIDK.js";import{f as we,g as Me,h as Re,i as Ve}from"./chunk-S65FGQPQ.js";import{a as ae}from"./chunk-Z5LIF3FH.js";import{a as Se,b as Ae,c as Oe,d as Ee,e as ke,f as Ne}from"./chunk-AJA27RCA.js";import"./chunk-FKF45QYA.js";import{B as xe,C as be,D as Fe,b as oe,d as M,g as ne,h as le,i as se,l as de,n as me,o as pe,p as ce,q as ue,r as fe,s as ge,t as he,u as _e,y as ye,z as Ce}from"./chunk-2IBYDHOE.js";import{aa as ee,ha as te,oa as ie,pa as re,qa as ve}from"./chunk-NPECNDHW.js";import{$b as N,Aa as Y,Ab as s,Bb as d,Ca as Z,Cb as b,D as P,F as J,Gb as B,Ic as K,Jb as v,L as Q,Lb as u,Ub as g,Vb as w,Wb as H,Xa as n,a as S,b as V,c as G,d as j,e as L,ea as x,hb as A,ja as W,ka as O,nb as z,p as I,pb as p,ra as X,sa as $,ta as q,vb as y,y as U,yb as E,zb as k}from"./chunk-Y4KEZB6L.js";var m=function(r){return r.required="required",r.minLength="minLength",r.maxLength="maxLength",r.email="email",r.validateRange="validateRange",r}(m||{});function qe(r,l,e){let t=!1,i=new Map;return r.controls.forEach(a=>{let o=a.get(l),c=o?.value;if(o?.hasError(e)){let f=o.errors||{},{[e]:h}=f,F=j(f,[G(e)]);o.setErrors(Object.keys(F).length>0?F:null)}if(c){let h=typeof c=="string"?c.toLowerCase():c;i.has(h)||i.set(h,[]),i.get(h).push(o)}}),i.forEach(a=>{a.length>1&&(t=!0,a.forEach(o=>{o.setErrors(V(S({},o.errors),{[e]:!0}))}))}),t}function T(r){return l=>{let e=l,t=!1;return r.forEach(i=>{if(i.isRepeated===!1){let a,o=!0;switch(i.fieldType){case"date":a="duplicatedDate";break;case"text":a="isDuplicated";break;case"email":a="duplicatedEmail";break;default:a="isDuplicated",o=!0;break}o&&qe(e,i.fieldName,a)&&(t=!0)}}),t?{hasDuplicates:!0}:null}}function R(r){if(!r||!r.errors)return;let l=r.errors,e=S({},l);e.dateRange!==void 0&&delete e.dateRange,Object.keys(e).length===0?r.setErrors(null):r.setErrors(e)}function De(r,l){return e=>{if(!(e instanceof se))return null;let t=e.get(r),i=e.get(l);if(!t?.value||!i?.value)return R(t),R(i),null;let a=new Date(t.value),o=new Date(i.value);return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getTime()>o.getTime()?(i.setErrors(V(S({},i.errors),{dateRange:{message:"La fecha final no puede ser anterior a la fecha inicial.",actual:i.value,target:t.value}})),i.touched||i.markAsTouched(),R(t),{dateRangeInvalid:!0}):(R(t),R(i),null)}}var Be=(r,l)=>l.fieldName,He=(r,l)=>l.id;function Ge(r,l){if(r&1&&(s(0,"label",9),g(1),d()),r&2){let e=u(),t=e.$implicit,i=e.$index,a=u(2);p("for",t.fieldName+i)("appSkeleton",a.isLoadingSig()),n(),H(" ",t.label," ")}}function je(r,l){if(r&1&&(s(0,"mat-form-field",10)(1,"mat-label"),g(2),d(),b(3,"input",12),d()),r&2){let e=u(),t=e.$implicit,i=e.$index,a=u(2);p("id",t.fieldName+i)("appSkeleton",a.isLoadingSig())("appReadOnly",t.isReadOnly),n(2),w(t.label),n(),p("type",t.fieldType)("formControlName",t.fieldName)("placeholder",t.fieldName)}}function Ue(r,l){if(r&1&&(s(0,"mat-form-field",10)(1,"mat-label"),g(2),d(),b(3,"input",12),d()),r&2){let e=u(),t=e.$implicit,i=e.$index,a=u(2);p("id",t.fieldName+i)("appSkeleton",a.isLoadingSig())("appReadOnly",t.isReadOnly),n(2),w(t.label),n(),p("type",t.fieldType)("formControlName",t.fieldName)("placeholder",t.fieldName)}}function Je(r,l){if(r&1&&(s(0,"mat-form-field",10)(1,"mat-label"),g(2),d(),b(3,"input",12),d()),r&2){let e=u(),t=e.$implicit,i=e.$index,a=u(2);p("id",t.fieldName+i)("appSkeleton",a.isLoadingSig())("appReadOnly",t.isReadOnly),n(2),w(t.label),n(),p("type",t.fieldType)("formControlName",t.fieldName)("placeholder",t.fieldName)}}function Qe(r,l){if(r&1&&(s(0,"div",11),b(1,"app-date-input",13),d()),r&2){let e,t,i,a=u(),o=a.$implicit,c=a.$index,f=u(2);n(),p("id",o.fieldName+c)("formControlName",o.fieldName)("label",(e=o.label)!==null&&e!==void 0?e:"")("placeholder",(t=o.label)!==null&&t!==void 0?t:"")("isDisabled",!1)("appSkeleton",f.isLoadingSig())("isReadOnly",(i=o.isReadOnly)!==null&&i!==void 0?i:!1)}}function We(r,l){if(r&1&&(s(0,"mat-option",15),g(1),d()),r&2){let e=l.$implicit;p("value",e.id),n(),H(" ",e.description," ")}}function Xe(r,l){if(r&1&&(s(0,"mat-form-field",10)(1,"mat-label"),g(2),d(),s(3,"mat-select",14),E(4,We,2,2,"mat-option",15,He),d()()),r&2){let e=u(),t=e.$implicit,i=e.$index,a=u().$implicit,o=u();p("id",t.fieldName+i)("appSkeleton",o.isLoadingSig())("appReadOnly",t.isReadOnly),n(2),w(t.fieldName),n(),p("formControlName",t.fieldName),n(),k(o.getOptionsForField(t.fieldName,a))}}function Ye(r,l){if(r&1&&(s(0,"div",4),z(1,Ge,2,3,"label",9)(2,je,4,7,"mat-form-field",10)(3,Ue,4,7,"mat-form-field",10)(4,Je,4,7,"mat-form-field",10)(5,Qe,2,7,"div",11)(6,Xe,6,5,"mat-form-field",10),d()),r&2){let e=l.$implicit;n(),y(1,e.label?1:-1),n(),y(2,e.fieldType==="text"?2:-1),n(),y(3,e.fieldType==="email"?3:-1),n(),y(4,e.fieldType==="number"?4:-1),n(),y(5,e.fieldType==="date"?5:-1),n(),y(6,e.fieldType==="select"?6:-1)}}function Ze(r,l){if(r&1){let e=B();s(0,"button",6),v("click",function(){$(e);let i=u(2);return q(i.addRow())}),s(1,"mat-icon",7),g(2,"add_circle"),d()()}if(r&2){let e=u(2);p("disabled",!e.isReadyToAdd()),n(),p("appSkeleton",e.isLoadingSig())}}function Ke(r,l){if(r&1){let e=B();s(0,"div",2)(1,"div",3),E(2,Ye,7,6,"div",4,Be),s(4,"div",5)(5,"button",6),v("click",function(){let i=$(e).$index,a=u();return q(a.removeRow(i))}),s(6,"mat-icon",7),g(7,"remove_circle"),d()(),z(8,Ze,3,2,"button",8),d()()()}if(r&2){let e=l.$index,t=u();p("formGroupName",e),n(2),k(t.formArrayConfig),n(3),p("disabled",t.rows.length===1),n(),p("appSkeleton",t.isLoadingSig()),n(2),y(8,e===t.rows.controls.length-1?8:-1)}}var Le=(()=>{class r{get rows(){return this.mainForm.get("rows")}constructor(){this.formArrayConfig=[],this.data=null,this.isLoadingSig=Y(!0),this.emitFormArrayValue=new Z,this.availableOptionsMap=A(new Map),this._selectedValuesByField=A({}),this._valueChangesSubscription=new L,this.isInitialized=!1,this._originalSelectItemsMap=new Map,this._fb=x(fe),this._createFormArray()}ngOnChanges(e){let t=e.formArrayConfig&&this.formArrayConfig.length>0,i=e.data;if(t&&!this.isInitialized)this._initFormStructure(),this.isInitialized=!0;else if(this.isInitialized){if(t){this.initializeSelectMaps();let a=T(this.formArrayConfig);this.rows.setValidators(a)}i&&this._resetAndLoadRows(this.data||[]),this._calculateSelectAvailableOptions(),this.rows.updateValueAndValidity()}}ngOnInit(){this.setupValueChangeSubscription()}ngOnDestroy(){this._valueChangesSubscription.unsubscribe()}trackByFn(e,t){return t.value}isReadyToAdd(){return this.maxRows!==null&&this.rows.length>=this.maxRows?!1:this.mainForm.valid}getOptionsForField(e,t){let a=t.get(e).value,o=this.formArrayConfig.find(_=>_.fieldName===e),c=this.availableOptionsMap().get(e)||[];if(o?.isRepeated||a===null)return c;let h=(this._selectedValuesByField()[e]||[]).filter(_=>_===a).length,C=(this._originalSelectItemsMap.get(e)||[]).find(_=>_.id===a);if(h<=1){if(!c.some(D=>D.id===a)&&C)return[...c,C].sort((D,Ie)=>{let Pe=D.description.toString().toLowerCase(),$e=Ie.description.toString().toLowerCase();return Pe.localeCompare($e)})}else return C?[C]:[];return c}isDuplicate(e,t){return(this._selectedValuesByField()[e]||[]).filter(a=>a===t).length>1}createRowGroup(e={}){let t={},i=[],a=null,o=null;for(let f of this.formArrayConfig){let h=this._getValidators(f),F=e[f.fieldName]??null;t[f.fieldName]=this._fb.control(F,h);let C=f.validations?.find(_=>_.type===m.validateRange&&typeof _.value=="string");C&&(o=f.fieldName,a=C.value)}return a&&o&&i.push(De(a,o)),this._fb.group(t,{validators:i})}addRow(){this.maxRows!==null&&this.rows.length>=this.maxRows||(this.formArrayConfig.map(e=>(e.isReadOnly&&(e.isReadOnly=!1),e)),this.rows.push(this.createRowGroup()),this.rows.markAsDirty())}removeRow(e){this.rows.length>1&&(this.rows.removeAt(e),this.rows.markAsDirty())}isRequired(e){return e.validations?.some(t=>t.type===m.required)??!1}_initFormStructure(){this.initializeSelectMaps();let e=T(this.formArrayConfig);this.rows.setValidators(e),this.rows.updateValueAndValidity(),this.data&&this.data.length>0?this._resetAndLoadRows(this.data):this.rows.length===0&&this.addRow(),this._calculateSelectAvailableOptions()}_createFormArray(){this.mainForm=this._fb.group({rows:this._fb.array([],{validators:[T(this.formArrayConfig)]})})}_resetAndLoadRows(e){this.rows.clear(),e.forEach(t=>{this.rows.push(this.createRowGroup(t))}),this.mainForm.markAsPristine()}initializeSelectMaps(){this.formArrayConfig.forEach(e=>{e.fieldType==="select"&&e.selectItems&&this._originalSelectItemsMap.set(e.fieldName,[...e.selectItems])})}setupValueChangeSubscription(){this._valueChangesSubscription.unsubscribe(),this._valueChangesSubscription=new L,this._valueChangesSubscription.add(this.rows.valueChanges.subscribe(()=>{this._calculateSelectAvailableOptions()})),this._valueChangesSubscription.add(this.rows.statusChanges.pipe(J(300)).subscribe(e=>{e==="VALID"?this.emitFormArrayValue.emit(this.rows.value):this.emitFormArrayValue.emit(null)}))}_calculateSelectAvailableOptions(){let e=new Map,t={};this.formArrayConfig.forEach(i=>{if(i.fieldType==="select"&&!i.isRepeated){let a=[];this.rows.controls.forEach(o=>{let c=o.get(i.fieldName);c?.value!=null&&a.push(c.value)}),t[i.fieldName]=a}}),this._selectedValuesByField.set(t),this.formArrayConfig.forEach(i=>{let a=this._originalSelectItemsMap.get(i.fieldName);if(i.fieldType==="select"&&a)if(i.isRepeated)e.set(i.fieldName,a);else{let o=t[i.fieldName]||[],c=new Set(o),f=a.filter(h=>!c.has(h.id));e.set(i.fieldName,f)}}),this.availableOptionsMap.set(e)}_getValidators(e){let t=[];if(e.validations)for(let i of e.validations){if(i.type===m.validateRange)continue;let a=i.value;switch(i.type){case m.required:t.push(M.required);break;case m.minLength:a&&typeof a=="number"&&t.push(M.minLength(a));break;case m.maxLength:a&&typeof a=="number"&&t.push(M.maxLength(a));break;case m.email:t.push(M.email);break;default:console.warn(`Validation type ${i.type} not recognized.`)}}return t}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275cmp=O({type:r,selectors:[["app-form-array"]],inputs:{formArrayConfig:"formArrayConfig",data:"data",maxRows:"maxRows",isLoadingSig:[W.SignalBased,"isLoadingSig"]},outputs:{emitFormArrayValue:"emitFormArrayValue"},standalone:!0,features:[X,N],decls:4,vars:1,consts:[[3,"formGroup"],["formArrayName","rows"],[3,"formGroupName"],[1,"grid"],[1,"inputs-container"],[1,"actions-container"],["mat-icon-button","",3,"click","disabled"],[3,"appSkeleton"],["mat-icon-button","",3,"disabled"],[3,"for","appSkeleton"],["appearance","outline",1,"width",3,"id","appSkeleton","appReadOnly"],[1,"component-container"],["matInput","","appCustomValidationMessage","",3,"type","formControlName","placeholder"],["appCustomValidationMessage","",1,"width",3,"id","formControlName","label","placeholder","isDisabled","appSkeleton","isReadOnly"],["appCustomValidationMessage","",3,"formControlName"],[3,"value"]],template:function(t,i){t&1&&(s(0,"form",0)(1,"div",1),E(2,Ke,9,4,"div",2,i.trackByFn,!0),d()()),t&2&&(p("formGroup",i.mainForm),n(2),k(i.rows.controls))},dependencies:[K,ge,de,oe,ne,le,he,me,ue,pe,ce,Ce,ye,_e,be,xe,re,ie,Ve,we,ee,Ae,Se,te,ve,Te,ae,Me,Re],styles:['@charset "UTF-8";.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:15px;margin-bottom:20px;padding:20px;border:1px solid white;border-radius:4px;width:100%}.inputs-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.inputs-container[_ngcontent-%COMP%]   .width[_ngcontent-%COMP%]{width:100%}.actions-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;gap:10px}@media (min-width: 600px){.grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr) auto;gap:20px 15px;align-items:end}.actions-container[_ngcontent-%COMP%]{grid-column:-1/-1;align-self:center;flex-direction:column}}@media (min-width: 1024px){.grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr) 120px;gap:20px;align-items:start}.actions-container[_ngcontent-%COMP%]{grid-column:-2/-1;grid-row:1/2;align-self:start;justify-content:flex-end;flex-direction:row}}@media (min-width: 1440px){.grid[_ngcontent-%COMP%]{background:#fff;grid-template-columns:repeat(4,1fr) 120px;gap:20px}.inputs-container[_ngcontent-%COMP%]{grid-column:span 1}.actions-container[_ngcontent-%COMP%]{grid-column:5/6;grid-row:1/2;align-self:start;justify-content:flex-end;flex-direction:row}}','.skeleton-loading[_ngcontent-%COMP%]{color:transparent!important;background-color:transparent!important;border-color:transparent!important;position:relative;overflow:hidden;pointer-events:none;min-height:1em}.skeleton-loading[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;border-radius:4px;z-index:10;background:linear-gradient(90deg,#eee 25%,#ddd,#eee 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite linear}mat-form-field.skeleton-loading[_ngcontent-%COMP%]   .mat-form-field-flex[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;border-radius:4px;z-index:10;background:linear-gradient(90deg,#eee 25%,#ddd,#eee 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite linear}button.skeleton-loading[_ngcontent-%COMP%]{background-color:#f0f0f0!important;color:transparent!important;box-shadow:none!important;position:relative;overflow:hidden}button.skeleton-loading[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;border-radius:inherit;z-index:10;background:linear-gradient(90deg,#eee 25%,#ddd,#eee 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite linear}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:200% 0}to{background-position:-200% 0}}']})}}return r})();var Yt=(()=>{class r{constructor(){this.isLoadingSig=A(!0),this.formArrayConfig1=[],this.formArrayConfig2=[],this.formArrayConfig3=[],this.employeeData1=[{country:1,gender:1,position:1,email:"juan.perez@empresa.com"},{country:2,gender:2,position:2,email:"ana.lopez@empresa.com"}],this.employeeData2=[{startDate:"2023-01-15",endDate:"2023-12-31",country:1,email:"juan.perez@empresa.com"},{startDate:"2024-03-01",endDate:"2024-05-30",country:1,email:"ana.lopez@empresa.com"}],this._positionServices=x(Oe),this._countryServices=x(Ee),this._alertService=x(Fe),this._breadcrumbService=x(ke),this._positions=[],this._countries=[],this._genders=[{id:0,description:"No binario"},{id:1,description:"Masculino"},{id:2,description:"Femenino"}],this._alertService.clearAlerts()}ngOnInit(){this._setBreadcrumb(),this._loadData()}ngOnDestroy(){this._breadcrumbService.clearBreadcrumbs()}getFormArray1Value(e){console.log("datos del form 1 Array",e)}getFormArray2Value(e){console.log("datos del form 2 Array",e)}getFormArray3Value(e){console.log("datos del form 3 Array",e)}_loadData(){this.isLoadingSig.set(!0),U({positions:this._getPositions(),countries:this._getCountries()}).pipe(Q(()=>{this.isLoadingSig.set(!1)})).subscribe({next:e=>{this._positions=e.positions,this._countries=e.countries,this._setFormArray1(),this._setFormArray2(),this._setFormArray3(),this.isLoadingSig.set(!1)},error:()=>{this.isLoadingSig.set(!1),this._alertService.showDanger("Error al cargar datos.")}})}_setFormArray1(){this.formArrayConfig1=[{fieldName:"country",fieldType:"select",selectItems:this._countries,label:"Pa\xEDs",placeHolder:"Selecciona un pa\xEDs",validations:[{type:m.required}],isRepeated:!0},{fieldName:"gender",fieldType:"select",selectItems:this._genders,label:"G\xE9nero",placeHolder:"Selecciona el g\xE9nero",validations:[{type:m.required}],isRepeated:!0},{fieldName:"position",fieldType:"select",selectItems:this._positions,label:"Puesto",placeHolder:"",validations:[{type:m.required}],isRepeated:!0},{fieldName:"email",fieldType:"email",label:"Email",placeHolder:"Ej: usuario@dominio.com",validations:[{type:m.required},{type:m.email}],isRepeated:!0}]}_setFormArray2(){this.formArrayConfig2=[{fieldName:"country",fieldType:"select",selectItems:this._countries,label:"Pa\xEDs",placeHolder:"Selecciona un pa\xEDs",validations:[{type:m.required}],isRepeated:!1},{fieldName:"position",fieldType:"select",selectItems:this._positions,label:"Puesto",placeHolder:"",validations:[{type:m.required}],isRepeated:!1},{fieldName:"date",fieldType:"date",label:"Fecha",placeHolder:"",validations:[{type:m.required}],isRepeated:!1},{fieldName:"email",fieldType:"email",label:"Email",placeHolder:"Ej: usuario@dominio.com",validations:[{type:m.required},{type:m.email}],isRepeated:!1}]}_setFormArray3(){this.formArrayConfig3=[{fieldName:"startDate",fieldType:"date",label:"Fecha Desde",placeHolder:"",validations:[{type:m.required}],isRepeated:!0},{fieldName:"endDate",fieldType:"date",label:"Fecha Hasta",placeHolder:"",validations:[{type:m.required},{type:m.validateRange,value:"startDate"}],isRepeated:!0},{fieldName:"email",fieldType:"email",label:"Email",placeHolder:"Ej: usuario@dominio.com",isRepeated:!1,isReadOnly:!0}]}_getPositions(){return this._positionServices.getPositions().pipe(P(()=>(this._alertService.showDanger("Error al cargar la lista de puestos."),I([]))))}_getCountries(){return this._countryServices.getCountries().pipe(P(()=>(this._alertService.showDanger("Error al cargar la lista de paises."),I([]))))}_setBreadcrumb(){this._breadcrumbService.setBreadcrumbs([{label:"Inicio",path:"/home"},{label:"Form-array",path:""}])}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275cmp=O({type:r,selectors:[["app-employee-form-array"]],standalone:!0,features:[N],decls:14,vars:10,consts:[[1,"main-container"],[1,"example1"],[3,"emitFormArrayValue","formArrayConfig","data","isLoadingSig","maxRows"],[1,"example2"],[3,"emitFormArrayValue","formArrayConfig","isLoadingSig","maxRows"],[1,"example3"],[3,"emitFormArrayValue","formArrayConfig","data","isLoadingSig"]],template:function(t,i){t&1&&(s(0,"div",0),b(1,"app-breadcrumb"),s(2,"div",1)(3,"h5"),g(4," Configuraci\xF3n: Todos los campos se pueden repetir, todos son obligatorios. M\xE1ximo de filas 5 "),d(),s(5,"app-form-array",2),v("emitFormArrayValue",function(o){return i.getFormArray1Value(o)}),d()(),s(6,"div",3)(7,"h5"),g(8," Configuraci\xF3n: Ningun campo se puede repetir, todos son obligatorios. M\xE1ximo de filas 3. "),d(),s(9,"app-form-array",4),v("emitFormArrayValue",function(o){return i.getFormArray2Value(o)}),d()(),s(10,"div",5)(11,"h5"),g(12," Configuraci\xF3n: Validaci\xF3n de rango de fechas y campos solo lectura "),d(),s(13,"app-form-array",6),v("emitFormArrayValue",function(o){return i.getFormArray3Value(o)}),d()()()),t&2&&(n(5),p("formArrayConfig",i.formArrayConfig1)("data",i.employeeData1)("isLoadingSig",i.isLoadingSig())("maxRows",5),n(4),p("formArrayConfig",i.formArrayConfig2)("isLoadingSig",i.isLoadingSig())("maxRows",3),n(4),p("formArrayConfig",i.formArrayConfig3)("data",i.employeeData2)("isLoadingSig",i.isLoadingSig()))},dependencies:[Le,Ne],styles:['@charset "UTF-8";.main-container[_ngcontent-%COMP%]{padding:20px 0}.example1[_ngcontent-%COMP%], .example2[_ngcontent-%COMP%], .example3[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:0 auto 50px}h5[_ngcontent-%COMP%]{padding:20px;letter-spacing:.1em;background-color:#f0f4f9;font-weight:400;color:#3f51b5;border:1px solid #e4e7f6;width:100%}']})}}return r})();export{Yt as EmployeeFormArrayComponent};
