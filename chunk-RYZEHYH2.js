import{b as m}from"./chunk-NPECNDHW.js";import{D as l,U as p,X as c,_ as f,ea as h,g as u,k as i,p as n}from"./chunk-Y4KEZB6L.js";var D=(()=>{class o{constructor(){this._apiUrl="https://json-server-data-fpl9.onrender.com/profile",this._usersUrl="https://json-server-data-fpl9.onrender.com/users",this.userProfileDataSubject=new i(null),this._http=h(m),this.userProfileDataSubject=new i(null),this.userProfileData$=this.userProfileDataSubject.asObservable()}login(t){return this._http.get(`${this._usersUrl}?username=${t.username}`).pipe(p(e=>{let r=e[0];if(r&&r.password===t.password){let s={id:r.id,username:r.username,roles:r.roles};return this.userProfileDataSubject.next(s),n(s)}return new u(s=>{s.complete()})}),l(e=>{throw e}))}logout(){this.userProfileDataSubject.next(null),console.log("Sesi\xF3n cerrada (Logout exitoso). Perfil limpiado.")}loadUserProfile(){return this._http.get(this._apiUrl).pipe(c(t=>{this.userProfileDataSubject.next(t)}),l(t=>(this.userProfileDataSubject.next(null),n({id:0,username:"Error",roles:[]}))))}hasAccess(t){if(!t||Array.isArray(t)&&t.length===0)return!0;let e=this.userProfileDataSubject.getValue()?.roles;if(!e)return!1;let r=Array.isArray(t)?t.map(a=>a.toUpperCase()):[t.toUpperCase()],s=e.map(a=>a.toUpperCase());return r.some(a=>s.includes(a))}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=f({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{D as a};
